{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pulse Eval Scenarios",
  "type": "object",
  "required": ["coverage_audit", "scenarios"],
  "properties": {
    "coverage_audit": {
      "type": "object",
      "description": "Analysis of Pulse's coverage before generating scenarios",
      "required": ["neighborhoods", "intents", "gaps"],
      "properties": {
        "neighborhoods": {
          "type": "object",
          "description": "Neighborhoods grouped by expected event density",
          "required": ["high_density", "medium_density", "low_density"],
          "properties": {
            "high_density": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Neighborhoods likely to always have events"
            },
            "medium_density": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Neighborhoods with events most nights"
            },
            "low_density": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Neighborhoods that often trigger the travel nudge"
            }
          }
        },
        "intents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "All user intents Pulse handles"
        },
        "gaps": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Coverage gaps, missing edge cases, or ambiguities in the spec"
        }
      }
    },
    "scenarios": {
      "type": "array",
      "minItems": 40,
      "maxItems": 40,
      "items": {
        "type": "object",
        "required": ["name", "category", "turns", "testing", "expected_behavior", "failure_modes"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Short descriptive label, e.g., 'Happy path: first-time EV user'"
          },
          "category": {
            "type": "string",
            "enum": ["happy_path", "edge_case", "poor_experience", "abuse_off_topic"],
            "description": "Scenario category"
          },
          "turns": {
            "type": "array",
            "minItems": 2,
            "maxItems": 10,
            "items": {
              "type": "object",
              "required": ["sender", "message"],
              "properties": {
                "sender": {
                  "type": "string",
                  "enum": ["user", "pulse"]
                },
                "message": {
                  "type": "string"
                }
              }
            }
          },
          "testing": {
            "type": "string",
            "description": "One-sentence description of the eval goal"
          },
          "expected_behavior": {
            "type": "string",
            "description": "What Pulse should do (for grading)"
          },
          "failure_modes": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 2,
            "description": "What would make this a bad experience"
          }
        }
      }
    }
  }
}
